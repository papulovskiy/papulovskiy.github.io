<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style>
        .cell {
            border: 1px solid #000;
            width: 20px;
            height: 20px;
            display: table-cell;
            text-align: center;
            font-weight: bold;
            font-size: 10px;
            vertical-align: middle;
        }
        .cell:hover {
            border: 1px solid #f00;
        }
    </style>
    <script>
        var field = {
            width: 10,
            height: 10,
            mines: 5,

            cells: [],

            generate: function () {
                this.cells = [];
                for (var x = 0; x < this.width; x++) {
                    this.cells[x] = [];
                    for (var y = 0; y < this.height; y++) {
                        this.cells[x][y] = {
                            neighbours: 0,
                            covered: true,
                            mine: false
                        };
                    }
                }

                var placed = 0;
                while (placed < this.mines) {
                    x = Math.floor(Math.random() * this.width);
                    y = Math.floor(Math.random() * this.height);

                    if (!this.cells[x][y].mine) {
                        placed++;
                        this.cells[x][y].mine = true;
                        for (var nx = x-1; nx <= x+1; nx++) {
                            for (var ny = y-1; ny <= y+1; ny++) {
                                if (this.cells[nx] != undefined && this.cells[nx][ny] != undefined && this.cells[nx][ny].mine == false) {
                                    this.cells[nx][ny].neighbours++;
                                }
                            }
                        }
                    }
                }
            },

            step: function (x, y) {
                if (!this.cells[x][y].covered) {
                    return;
                }
                var cell = document.getElementById('cell-' + x + '-' + y);
                this.cells[x][y].covered = false;

                if (this.cells[x][y].mine) {
                    cell.innerHTML = 'X';
                } else {
                    if (this.cells[x][y].neighbours > 0) {
                        cell.innerHTML = this.cells[x][y].neighbours;
                    } else {
                        for (var nx = x-1; nx <= x+1; nx++) {
                            for (var ny = y-1; ny <= y+1; ny++) {
                                this.step(nx, ny);
                                if (this.cells[nx] != undefined && this.cells[nx][ny] != undefined && this.cells[nx][ny].mine == false) {
                                    this.cells[nx][ny].covered = false;
                                    cell = document.getElementById('cell-' + nx + '-' + ny);
                                    cell.innerHTML = this.cells[nx][ny].neighbours;
                                }
                            }
                        }
                    }
                }
            },

            test: function() {
                var uncovered = 0;
                for (var x = 0; x < this.width; x++) {
                    for (var y = 0; y < this.height; y++) {
                        if (!this.cells[x][y].covered) {
                            uncovered++;
                        }
                    }
                }
                return uncovered == this.mines;
            }

        };

        window.onload = function() {
            field.generate();
            showField('field');
        };

        function showField(id) {
            var parent = document.getElementById(id);
            parent.innerHTML = "";
            var row;
            var cell;
            for (var y = 0; y < field.width; y++) {
                row = document.createElement('div');
                row.id = 'row-' + y;
                row.className = 'row';
                for (var x = 0; x < field.width; x++) {
                    cell = document.createElement('span');
                    cell.id = 'cell-' + x + '-' + y;
                    cell.className = 'cell';
                    addClick(cell, x, y);
                    row.appendChild(cell);
                }
                parent.appendChild(row);
            }
        }

        function addClick(cell, x, y) {
            var cx = x;
            var cy = y;
            var handler = function() {
                field.step(cx, cy);
                console.log(field.test());
            };
            return cell.onclick = handler;
        }
    </script>
</head>
<body>
<div id="field"></div>
</body>
</html>