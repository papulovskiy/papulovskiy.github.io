<!DOCTYPE html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8">
    <style>


        h1, h2, h3 {
            font-weight: normal;
        }


        .footnote {
            position: absolute;
            bottom: 3em;
        }

        .diagram img {
            width: 100%;
        }

          rect.reads {
            fill: red;
            stroke: blue;
            height: 100;
          }

    </style>
  </head>
  <body>
    <textarea id="source">
name: Title
class: center, middle

# A billion rows pet-project on a desktop hardware
#### Alexey Papulovskiy

PostgreSQL Conference Europe

.footnote[Tallinn, Estonia 03.11.2016]

.footnote[]

---

# About me

Developer at Booking.com

---

# reverse.report

8.8.8.8 → 8.8.8.8.in-addr.arpa → google-public-dns-a.google.com.

IP v4

2<sup>32</sup> = 4 294 967 296 possible IP addresses

3 702 258 432 assigned IP addresses TODO: recheck
???
"Reverse" IP ordering to not to overload DNS-servers

---

# Desktop hardware

CPU: 4 cores (8 threads) @4GHz with 8MB L3 cache
Memory: 64GB non-ECC DDR4
Storage:
 512GB NVMe SSD
 1TB SATA SSD
 4TB Spinning disk
500mbps internet connection

???
TODO: refine
---

title: SSD matters

<!--
  http://jsfiddle.net/gh/get/jquery/1.9.1/highslide-software/highcharts.com/tree/master/samples/highcharts/demo/column-parsed/
-->

.diagram[![SSD IOPS comparison](assets/ssd_chart_log.svg)]

???
Measured with fio tool (75% reads, 25% writes) on 4GB file.

It's hard to compare environmets, so the measurement has been done to see the trend, not for absolute values.

Logarithmic scale just to make spinning disk visible

---

title: SSD matters

.diagram[![SSD IOPS comparison](assets/ssd_chart_linear.svg)]

---

# Database

9.5/9.6

TODO: postgresql.conf settings

---

# Data collection

python script
home router (30kpps)
DDoS detector (5kpps)

---

# Database schema

---

# Updates

Consistency
Unlogged tables
Update rate

---

# Data types


---

# Reads
varchar_ops

---

# Search
trigram

---

# Pain
## Disc space
inet vs int
varchar(126)

---

# Pain
### PG 9.5

    reverse=# vacuum analyze rev;
    VACUUM
    Time: 13063518.770 ms

### PG 9.6

    reverse=# vacuum analyze rev;
    VACUUM
    Time: 13156379.585 ms

???
No difference between versions, but no one expected

---

# Updates
TODO: do not update values that not changed
TODO: description of rows version, indexing and WAL
---

# Reads
TODO: sort in query
TODO: recursive queries

---

# Nice features

    </textarea>
    <script src="assets/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>